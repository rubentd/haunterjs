<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>haunterjs by rubentd</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">haunterjs</h1>
      <h2 class="project-tagline">CSS regression testing tool focused on simplicity</h2>
      <a href="https://github.com/rubentd/haunterjs" class="btn">View on GitHub</a>
      <a href="https://github.com/rubentd/haunterjs/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/rubentd/haunterjs/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><img src="http://rubentd.com/haunterjs/img/icon.png" alt="logo" title="logo"> </p>

<h1>
<a id="haunterjs" class="anchor" href="#haunterjs" aria-hidden="true"><span class="octicon octicon-link"></span></a>haunterjs</h1>

<p><a href="http://badge.fury.io/js/haunterjs"><img src="https://badge.fury.io/js/haunterjs.svg" alt="npm version"></a> <a href="https://travis-ci.org/rubentd/haunterjs"><img src="https://travis-ci.org/rubentd/haunterjs.svg" alt="Build Status"></a></p>

<h2>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Table of Contents</h2>

<ul>
<li><a href="#about-haunterjs">About haunterjs</a></li>
<li><a href="#taking-snaps">Taking snaps</a></li>
<li><a href="#responsive-sites">Responsive sites</a></li>
<li><a href="#snap-viewer">Snap viewer</a></li>
<li><a href="#solving-conflicts">Solving conflicts</a></li>
<li><a href="#api-documentation">API documentation</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#best-practices">Best practices</a></li>
</ul>

<h2>
<a id="about-haunterjs" class="anchor" href="#about-haunterjs" aria-hidden="true"><span class="octicon octicon-link"></span></a>About haunterjs</h2>

<p>When you work on a big website or web application, you (and maybe a bunch of people) are constantly introducing changes in the visual components.<br>
Sometimes this changes are intentional, as you are improving the look and feel, or adding new features, but sometimes this changes are introduced by mistake.<br>
Imagine you are refactoring some component, for example a button, but you are not sure how this change is gonna impact the site. You would need to browse the whole site to make sure everything looks good.<br>
With css regression tests you can automate the process, and make sure none breaks the styles across the website.
<br>
There are some tools like <a href="https://github.com/huddle/phantomcss">PhantomCSS</a> 
or <a href="https://github.com/BBC-News/wraith">wraith</a> 
which allow you to write tests to compare screenshots of your website and detect changes.</p>

<p><br>
haunterjs was built on top of <a href="https://github.com/huddle/phantomcss">PhantomCSS</a>, 
adding some new features:</p>

<ol>
<li>Annotations for each screenshot</li>
<li>Sense of ordered steps in the execution of the test</li>
<li>More simplicity in the syntax for the tests</li>
<li>A viewer to compare and choose the correct screenshots</li>
</ol>

<p>haunterjs masks some complex features of casperjs, allowing to code simple tests, with a more compact and readable syntax.</p>

<p>This example test opens github.com and searches for 'bootstrap'</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> haunter <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>../haunter.js<span class="pl-pds">'</span></span>);
haunter.<span class="pl-c1">start</span>(<span class="pl-s"><span class="pl-pds">'</span>search/bootstrap<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Search for bootstrap repo<span class="pl-pds">'</span></span>);
haunter.goToUrl(<span class="pl-s"><span class="pl-pds">'</span>https://github.com/<span class="pl-pds">'</span></span>);
haunter.snap(<span class="pl-s"><span class="pl-pds">'</span>.header<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Go to github.com<span class="pl-pds">'</span></span>);
haunter.sendKeys(<span class="pl-s"><span class="pl-pds">'</span>input[type=text]<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>bootstrap<span class="pl-pds">'</span></span>);
haunter.snap(<span class="pl-s"><span class="pl-pds">'</span>.header<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Type bootstrap on the search field<span class="pl-pds">'</span></span>);
haunter.pressEnter(<span class="pl-s"><span class="pl-pds">'</span>input[type=text]<span class="pl-pds">'</span></span>);
haunter.snap(<span class="pl-s"><span class="pl-pds">'</span>.sort-bar<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Press enter and view number of results<span class="pl-pds">'</span></span>);
haunter.end();</pre></div>

<p><br></p>

<h2>
<a id="taking-snaps" class="anchor" href="#taking-snaps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Taking snaps</h2>

<p>haunterjs is based on the concept of <strong>snaps</strong>.</p>

<p>A snap is a screenshot of a given css selector and an annotation for that screenshot, describing the current action being performed. </p>

<div class="highlight highlight-source-js"><pre>haunter.snap(<span class="pl-s"><span class="pl-pds">'</span>.sort-bar<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Press enter and view number of results<span class="pl-pds">'</span></span>);</pre></div>

<p><br></p>

<h2>
<a id="responsive-sites" class="anchor" href="#responsive-sites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Responsive sites</h2>

<p>haunterjs allows to configure multiple viewports, to test responsive sites in a single test.<br>
This way haunterjs will take screenshots with every screen size in each snap.</p>

<div class="highlight highlight-source-js"><pre>config.defaultViewports <span class="pl-k">=</span> [
    { 
        name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>small<span class="pl-pds">'</span></span>,
        width<span class="pl-k">:</span> <span class="pl-c1">320</span>, 
        height<span class="pl-k">:</span> <span class="pl-c1">480</span>
    },
    { 
        name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>medium<span class="pl-pds">'</span></span>,
        width<span class="pl-k">:</span> <span class="pl-c1">768</span>, 
        height<span class="pl-k">:</span> <span class="pl-c1">480</span>
    },
    { 
        name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>large<span class="pl-pds">'</span></span>,
        width<span class="pl-k">:</span> <span class="pl-c1">1024</span>, 
        height<span class="pl-k">:</span> <span class="pl-c1">768</span>
    }
];</pre></div>

<p>If you want to take a snap of a single component, like a button, and you don't care about multiple screen sizes, call the snap method with the last parameter with false value.</p>

<div class="highlight highlight-source-js"><pre>haunter.snap(<span class="pl-s"><span class="pl-pds">'</span>.selector<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Annotation<span class="pl-pds">'</span></span>, <span class="pl-c1">false</span>);</pre></div>

<p><br></p>

<h2>
<a id="snap-viewer" class="anchor" href="#snap-viewer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Snap viewer</h2>

<p>haunterjs includes a snap viewer written in nodejs and angularjs. You can use this tool as a navigation manual, browsing the snapshots of a specific user flow. You can compare them and choose the correct one, in the event of conflict.</p>

<p><br><br>
<img src="http://rubentd.com/haunterjs/img/viewer-index.png" alt="snap viewer" title="snap viewer">
<br><br></p>

<p>haunterjs allows the test to be structured in a hierarchy or folder system, to facilitate the process of browsing/running the tests.
For example you can separate your tests by features or modules of your website.</p>

<p>This <em>virtual path</em> is setup in each test:</p>

<div class="highlight highlight-source-js"><pre>haunter.<span class="pl-c1">start</span>(<span class="pl-s"><span class="pl-pds">'</span>search/bootstrap<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Search for bootstrap repo<span class="pl-pds">'</span></span>);</pre></div>

<p><br></p>

<h2>
<a id="solving-conflicts" class="anchor" href="#solving-conflicts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solving conflicts</h2>

<p>When a conflict it's found, the viewer asks you which one is the correct version of that component.</p>

<p><br><br>
<img src="http://rubentd.com/haunterjs/img/conflict.gif" alt="snap viewer" title="snap viewer">
<br><br></p>

<p>So you can update the baseline screenshot, or fix possible visual inconsistencies.</p>

<p><br><br>
<img src="http://rubentd.com/haunterjs/img/choose-correct.png" alt="snap viewer" title="snap viewer">
<br><br></p>

<p>After solving the conflicts, you must commit the changes in your repo.</p>

<p><br></p>

<h2>
<a id="api-documentation" class="anchor" href="#api-documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>API Documentation</h2>

<h4>
<a id="haunterstarthierarchy-description" class="anchor" href="#haunterstarthierarchy-description" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.start(hierarchy, description)</code>
</h4>

<p>Initialize components needed to run the test<br>
<em>Parameters</em><br>
    <code>hierarchy {String}</code> A virtual path to organize the test<br>
    <code>description {String}</code> Description of the test</p>

<hr>

<h4>
<a id="hauntersetviewportsviewports" class="anchor" href="#hauntersetviewportsviewports" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.setViewports(viewports)</code>
</h4>

<p>Sets viewport dimensions for the test. Setup the viewport after calling the method start()<br>
<em>Parameters</em><br>
    <code>viewports {Array}</code> Array of desired viewports. Each viewport has name, width and height)</p>

<hr>

<h4>
<a id="hauntersetuseragentua" class="anchor" href="#hauntersetuseragentua" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.setUserAgent(ua)</code>
</h4>

<p>Sets user agent for the test<br>
<em>Parameters</em><br>
    <code>ua {String}</code> User Agent string</p>

<hr>

<h4>
<a id="hauntergotourlurl" class="anchor" href="#hauntergotourlurl" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.goToUrl(url)</code>
</h4>

<p>Navigate to that url<br>
<em>Parameters</em><br>
    <code>url {String}</code> Destination url</p>

<hr>

<h4>
<a id="hauntersnapcssselector-annotation-multiple" class="anchor" href="#hauntersnapcssselector-annotation-multiple" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.snap(cssSelector, annotation, multiple)</code>
</h4>

<p>Take a screenshot with an annotation<br>
<em>Parameters</em><br>
    <code>cssSelector {String}</code> CSS selector of the element to capture<br>
    <code>annotation {String}</code> Comment for the screnshot
    <code>multiple {boolean}</code> Take screenshot in all the viewports?</p>

<hr>

<h4>
<a id="hauntersnapexcludingcssselector-excludeselector-annotation-multiple" class="anchor" href="#hauntersnapexcludingcssselector-excludeselector-annotation-multiple" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.snapExcluding(cssSelector, excludeSelector, annotation, multiple)</code>
</h4>

<p>Take a screenshot excluding an element<br>
<em>Parameters</em><br>
    <code>cssSelector {String}</code> CSS selector of the element to capture<br>
    <code>excludeSelector {String}</code> CSS selector of the element to exclude<br>
    <code>annotation {String}</code> Comment for the screnshot
    <code>multiple {boolean}</code> Take screenshot in all the viewports?</p>

<hr>

<h4>
<a id="haunterclickcssselector" class="anchor" href="#haunterclickcssselector" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.click(cssSelector)</code>
</h4>

<p>Click an element<br>
<em>Parameters</em><br>
    <code>cssSelector {String}</code> CSS selector of the element to click</p>

<hr>

<h4>
<a id="hauntersendkeyscssselector-keys" class="anchor" href="#hauntersendkeyscssselector-keys" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.sendKeys(cssSelector, keys)</code>
</h4>

<p>Type some text into an element<br>
<em>Parameters</em><br>
    <code>cssSelector {String}</code> CSS selector of the element to send keys to<br>
    <code>keys {String}</code> String of text to input in the element</p>

<hr>

<h4>
<a id="haunterpressentercssselector" class="anchor" href="#haunterpressentercssselector" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.pressEnter(cssSelector)</code>
</h4>

<p>Press enter key while focused on an element<br>
<em>Parameters</em><br>
    <code>cssSelector {String}</code> CSS selector of the element to focus</p>

<hr>

<h4>
<a id="hauntermouseovercssselector" class="anchor" href="#hauntermouseovercssselector" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.mouseover(cssSelector)</code>
</h4>

<p>Place the mouse over some element<br>
<em>Parameters</em><br>
    <code>cssSelector {String}</code> CSS selector of the element to mouseover</p>

<hr>

<h4>
<a id="haunteruploadfilecssselector-filepath" class="anchor" href="#haunteruploadfilecssselector-filepath" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.uploadFile(cssSelector, filePath)</code>
</h4>

<p>Upload a file to the browser<br>
<em>Parameters</em><br>
    <code>cssSelector {String}</code> CSS selector for the file input
    <code>filePath {String}</code> Path to the file to upload</p>

<hr>

<h4>
<a id="haunterevaluateactions-params" class="anchor" href="#haunterevaluateactions-params" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.evaluate(actions, params)</code>
</h4>

<p>Evaluate some js code on the browser
<em>Parameters</em><br>
    <code>actions {function}</code> JavaScript code to evaluate
    <code>params {Object}</code> Params for the js evaluation</p>

<hr>

<h4>
<a id="haunterwait" class="anchor" href="#haunterwait" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.wait()</code>
</h4>

<p>Wait some time in ms. Masks casperjs wait
<em>Parameters</em><br>
    <code>miliseconds {Number}</code> Time in miliseconds to wait</p>

<hr>

<h4>
<a id="haunterend" class="anchor" href="#haunterend" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>haunter.end()</code>
</h4>

<p>Proceed to compare the screenshots and figure out if there are errors</p>

<hr>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>haunterjs is available as a node package</p>

<pre><code>npm install haunterjs
</code></pre>

<p><br></p>

<p>Start by setting up your configuration on the <em>config.js</em> file. Or just leave all the values by default.
Make sure the <em>viewerPort</em> configured in the config.js file matches the one in <em>www/js/app.js</em></p>

<p>Run the demo tests with:</p>

<pre><code>casperjs test demo-tests
</code></pre>

<p>Run the snap viewer with: </p>

<pre><code>node viewer.js
</code></pre>

<p>And then open http://localhost:[viewerPort] in your browser  </p>

<h2>
<a id="best-practices" class="anchor" href="#best-practices" aria-hidden="true"><span class="octicon octicon-link"></span></a>Best practices</h2>

<h3>
<a id="organize-tests" class="anchor" href="#organize-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Organize tests</h3>

<p>Using a tidy hierarchization, you can sort them by features, or modules within your webapp.  </p>

<h3>
<a id="take-a-look-at-phantomcss-best-practices" class="anchor" href="#take-a-look-at-phantomcss-best-practices" aria-hidden="true"><span class="octicon octicon-link"></span></a>Take a look at <a href="https://github.com/Huddle/PhantomCSS#best-practices">PhantomCSS best practices</a>
</h3>

<p>Which I will summarize here:  </p>

<ul>
<li>Try not to use complex CSS3 selectors for asserting or creating screenshots. Prefer ids.</li>
<li>Do not use these as a replacement for functional tests</li>
<li>Don't try to test all the visuals</li>
<li>Full page screenshots are a bad idea</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/rubentd/haunterjs">haunterjs</a> is maintained by <a href="https://github.com/rubentd">rubentd</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-62906708-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
